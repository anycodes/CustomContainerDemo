name: publish

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v2
      with:
        node-version: 12
        registry-url: https://registry.npmjs.org/
    - run: npm install -g @serverless-devs/s
    - run: s config add --AccountID ${{secrets.ALIYUN_ACCOUNT_ID}} --AccessKeyID ${{secrets.ALIYUN_ACCESS_KEY_ID}} --AccessKeySecret ${{secrets.ALIYUN_ACCESS_KEY_SECRET}} -a website_access
    - run: version=${cat tag}
    - run: registry='registry.cn-shanghai.aliyuncs.com/custom-container/test:'
    - run: export IMAGE=$registry$version
    - run: s build --use-docker
    - run: s deploy --push-registry acr-internet --use-local -y
